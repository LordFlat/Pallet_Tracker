{% extends "base.html" %}
{% set title = "Dashboard" %}

{% block content %}

<div class="space-y-6">

  {% if has_query %}
  <!-- TOTAL CARD -->
  <div class="bg-white rounded-2xl border border-slate-100 shadow-sm p-6">
    <div class="text-slate-500 text-sm">Total punnets (current)</div>
    <div class="text-3xl font-semibold mt-1">{{ total }}</div>
  </div>
  {% endif %}


  <!-- SEARCH CARD -->
  <div class="bg-white rounded-2xl border border-slate-100 shadow-sm p-6">

    <form method="get" action="/" class="w-full flex flex-col gap-4">

      <input 
        type="text"
        name="q"
        value="{{ q }}"
        list="categorySuggestions"
        placeholder="Search by location (L03C) or category nameâ€¦"
        class="w-full px-4 py-4 rounded-xl border border-slate-200
               focus:outline-none focus:ring-2 focus:ring-slate-200" 
      />

      <button 
        type="submit"
        class="w-full px-6 py-4 rounded-xl
               bg-slate-900 text-white hover:opacity-90 transition">
        Search
      </button>

    </form>

    <datalist id="categorySuggestions">
      {% for s in suggestions %}
        <option value="{{ s }}"></option>
      {% endfor %}
    </datalist>

    <div class="text-xs text-slate-500 mt-3">
      Tip: You can type 
      <span class="font-medium">L3C</span> or 
      <span class="font-medium">L03C</span>.
    </div>

  </div>


  {% if has_query %}
  <!-- RESULTS TABLE -->
  <div class="bg-white rounded-2xl border border-slate-100 shadow-sm overflow-hidden">

    <div class="px-5 py-4 border-b border-slate-100 flex items-center justify-between">
      <div class="font-semibold">Current pallets</div>
      <div class="text-sm text-slate-500">{{ pallets|length }} item(s)</div>
    </div>

    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead class="text-slate-500">
          <tr class="border-b border-slate-100">
            <th class="text-left font-medium px-5 py-3">Category</th>
            <th class="text-left font-medium px-5 py-3">Zone</th>
            <th class="text-left font-medium px-5 py-3">Location</th>
            <th class="text-left font-medium px-5 py-3">Punnets</th>
            <th class="text-right font-medium px-5 py-3">Action</th>
          </tr>
        </thead>

        <tbody>
          {% for p in pallets %}
          <tr class="border-b border-slate-50 hover:bg-slate-50 transition">

            <!-- CATEGORY -->
            <td class="px-5 py-3">
              <div class="font-medium">{{ p.category_name }}</div>
              {% if p.description %}
              <div class="text-xs text-slate-500 mt-1">
                {{ p.description }}
              </div>
              {% endif %}
            </td>

            <!-- ZONE -->
            <td class="px-5 py-3">
              {{ p.zone.name if p.zone else "-" }}
            </td>

            <!-- LOCATION -->
            <td class="px-5 py-3 font-mono">
              {{ p.location.code if p.location else "-" }}
            </td>

            <!-- PUNNETS -->
            <td class="px-5 py-3">
              {{ p.punnets }}
            </td>

            <!-- ACTION -->
            <td class="px-5 py-3 text-right">
              <div x-data="{ open:false }" class="inline-flex items-center gap-2">

                <a href="/move/{{ p.id }}"
                   class="px-3 py-2 rounded-xl bg-white border border-slate-200
                          hover:border-slate-300 hover:shadow-sm transition">
                  Move
                </a>

                <button @click="open=true"
                        class="px-3 py-2 rounded-xl bg-white border border-slate-200
                               hover:border-slate-300 hover:shadow-sm transition">
                  Remove
                </button>

                <!-- MODAL -->
                <div x-show="open"
                     x-transition
                     class="fixed inset-0 bg-black/20 grid place-items-center p-4">

                  <div @click.away="open=false"
                       class="bg-white rounded-2xl shadow-lg border border-slate-100
                              w-full max-w-md p-6">

                    <div class="text-lg font-semibold">
                      Remove pallet?
                    </div>

                    <p class="text-slate-600 mt-2 text-sm">
                      This will clear location
                      <span class="font-mono font-medium">
                        {{ p.location.code if p.location else "-" }}
                      </span>.
                    </p>

                    <div class="flex gap-3 mt-5 justify-end">

                      <button @click="open=false"
                        class="px-4 py-2 rounded-xl bg-white border border-slate-200
                               hover:border-slate-300 transition">
                        Cancel
                      </button>

                      <form method="post" action="/remove/{{ p.id }}">
                        <button class="px-4 py-2 rounded-xl
                                       bg-slate-900 text-white hover:opacity-90 transition">
                          Remove
                        </button>
                      </form>

                    </div>
                  </div>
                </div>

              </div>
            </td>

          </tr>
          {% endfor %}

          {% if pallets|length == 0 %}
          <tr>
            <td colspan="5"
                class="px-5 py-10 text-center text-slate-500">
              No pallets found.
            </td>
          </tr>
          {% endif %}

        </tbody>
      </table>
    </div>

  </div>
  {% else %}
  <div class="bg-white rounded-2xl border border-slate-100 shadow-sm p-10 text-center text-slate-500">
    Start typing a category (e.g.
    <span class="font-medium">BB75</span>)
    or a location (e.g.
    <span class="font-mono font-medium">L03C</span>).
  </div>
  {% endif %}

</div>

{% endblock %}
