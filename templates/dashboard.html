{% extends "base.html" %}
{% set title = "Dashboard" %}

{% block content %}

<div class="space-y-6">

  <!-- CONTROLS CARD -->
  <div class="bg-white rounded-2xl border border-slate-100 shadow-sm p-6 space-y-4">

    <!-- ZONE SELECT -->
    <form method="get" action="/" class="flex flex-col sm:flex-row gap-4 items-center">

      <div class="flex items-center gap-3">
        <label class="text-sm text-slate-500">Zone:</label>
        <select name="zone"
                class="px-4 py-2 rounded-xl border border-slate-200 focus:ring-2 focus:ring-slate-200"
                onchange="this.form.submit()">
          {% for z in zones %}
            <option value="{{ z.name }}"
              {% if z.name == selected_zone %}selected{% endif %}>
              {{ z.name }}
            </option>
          {% endfor %}
        </select>
      </div>

      <!-- SEARCH -->
      <div class="flex-1 flex gap-4 w-full">
        <input
          type="text"
          name="q"
          value="{{ q }}"
          list="categorySuggestions"
          placeholder="Search by location (L03C) or category name…"
          class="flex-1 px-4 py-3 rounded-xl border border-slate-200
                 focus:outline-none focus:ring-2 focus:ring-slate-200"
        />

        <button
          type="submit"
          class="px-6 py-3 rounded-xl
                 bg-slate-900 text-white
                 hover:opacity-90 transition
                 sm:w-auto w-full shadow-sm">
          Search
        </button>
      </div>

    </form>

    <datalist id="categorySuggestions">
      {% for s in suggestions %}
        <option value="{{ s }}"></option>
      {% endfor %}
    </datalist>

  </div>

  <!-- RESULTS TABLE -->
  <div class="bg-white rounded-2xl border border-slate-100 shadow-sm overflow-hidden">

    <div class="px-5 py-4 border-b border-slate-100 flex items-center justify-between">
      <div class="font-semibold">Current pallets — {{ selected_zone }}</div>
      <div class="text-sm text-slate-500">{{ pallets|length }} item(s)</div>
    </div>

    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead class="text-slate-500">
          <tr class="border-b border-slate-100">
            <th class="text-left font-medium px-5 py-3">Category</th>
            <th class="text-left font-medium px-5 py-3">Zone</th>
            <th class="text-left font-medium px-5 py-3">Location</th>
            <th class="text-left font-medium px-5 py-3">Punnets</th>
            <th class="text-right font-medium px-5 py-3">Action</th>
          </tr>
        </thead>

        <tbody>
          {% for p in pallets %}
          <tr class="border-b border-slate-50 hover:bg-slate-50 transition">

            <td class="px-5 py-3">
              <div class="font-medium">{{ p.category_name }}</div>
              {% if p.description %}
              <div class="text-xs text-slate-500 mt-1">
                {{ p.description }}
              </div>
              {% endif %}
            </td>

            <td class="px-5 py-3">
              {{ p.zone.name if p.zone else "-" }}
            </td>

            <td class="px-5 py-3 font-mono">
              {{ p.location.code if p.location else "-" }}
            </td>

            <td class="px-5 py-3">
              {{ p.punnets }}
            </td>

            <td class="px-5 py-3 text-right">
              <div x-data="{ open:false }" class="inline-flex items-center gap-2">

                <a href="/move/{{ p.id }}"
                   class="px-3 py-2 rounded-xl bg-white border border-slate-200
                          hover:border-slate-300 hover:shadow-sm transition">
                  Move
                </a>

                <button @click="open=true"
                        class="px-3 py-2 rounded-xl bg-white border border-slate-200
                               hover:border-slate-300 hover:shadow-sm transition">
                  Remove
                </button>

                <div x-show="open"
                     x-transition
                     class="fixed inset-0 bg-black/20 grid place-items-center p-4">

                  <div @click.away="open=false"
                       class="bg-white rounded-2xl shadow-lg border border-slate-100
                              w-full max-w-md p-6">

                    <div class="text-lg font-semibold">
                      Remove pallet?
                    </div>

                    <p class="text-slate-600 mt-2 text-sm">
                      This will clear location
                      <span class="font-mono font-medium">
                        {{ p.location.code if p.location else "-" }}
                      </span>.
                    </p>

                    <div class="flex gap-3 mt-5 justify-end">

                      <button @click="open=false"
                        class="px-4 py-2 rounded-xl bg-white border border-slate-200
                               hover:border-slate-300 transition">
                        Cancel
                      </button>

                      <form method="post" action="/remove/{{ p.id }}">
                        <button class="px-4 py-2 rounded-xl
                                       bg-slate-900 text-white hover:opacity-90 transition">
                          Remove
                        </button>
                      </form>

                    </div>
                  </div>
                </div>

              </div>
            </td>

          </tr>
          {% endfor %}

          {% if pallets|length == 0 %}
          <tr>
            <td colspan="5"
                class="px-5 py-10 text-center text-slate-500">
              No pallets in this zone.
            </td>
          </tr>
          {% endif %}

        </tbody>
      </table>
    </div>

  </div>

</div>

{% endblock %}
